<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis of 'Advancing President's Executive Orders' Question in Federal Job Questionnaires</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <style>
        .tab-content {
            padding: 20px 0;
        }
        .stats-card {
            margin-bottom: 20px;
        }
        .heatmap-table td {
            text-align: center;
            padding: 8px;
        }
        .heatmap-cell {
            background: linear-gradient(to right, #ffffff var(--percent), #0d6efd var(--percent));
        }
        .dataTables_filter {
            display: none;
        }
        tfoot input {
            width: 100%;
            padding: 3px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="mt-4 mb-4">Analysis of 'Advancing President's Executive Orders' Question in Federal Job Questionnaires</h1>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs" id="analysisTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button">Overview</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="service-tab" data-bs-toggle="tab" data-bs-target="#service" type="button">By Service Type</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="grade-tab" data-bs-toggle="tab" data-bs-target="#grade" type="button">By Grade Level</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="location-tab" data-bs-toggle="tab" data-bs-target="#location" type="button">By Location</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="agency-tab" data-bs-toggle="tab" data-bs-target="#agency" type="button">By Agency</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="occupation-tab" data-bs-toggle="tab" data-bs-target="#occupation" type="button">By Occupation</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button">Timeline</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs" type="button">Job Listings</button>
                    </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content" id="analysisTabContent">
                    <!-- Overview Tab -->
                    <div class="tab-pane fade show active" id="overview" role="tabpanel">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Total Scraped Questionnaires</h5>
                                        <h2 class="text-primary" id="totalScraped">-</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <h5 class="card-title">With EO Question</h5>
                                        <h2 class="text-success" id="totalWithEO">-</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card stats-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Percentage</h5>
                                        <h2 class="text-info" id="percentageWithEO">-</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <h3>Data Coverage</h3>
                                <p id="dataCoverage"></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Type Tab -->
                    <div class="tab-pane fade" id="service" role="tabpanel">
                        <h3>Service Type Analysis</h3>
                        <div id="serviceTable"></div>
                    </div>
                    
                    <!-- Grade Level Tab -->
                    <div class="tab-pane fade" id="grade" role="tabpanel">
                        <h3>Grade Level Analysis (Top 10)</h3>
                        <div id="gradeTable"></div>
                    </div>
                    
                    <!-- Location Tab -->
                    <div class="tab-pane fade" id="location" role="tabpanel">
                        <h3>Geographic Analysis (Top 10)</h3>
                        <div id="locationTable"></div>
                    </div>
                    
                    <!-- Agency Tab -->
                    <div class="tab-pane fade" id="agency" role="tabpanel">
                        <h3>Agency Analysis (Top 20)</h3>
                        <div id="agencyTable"></div>
                    </div>
                    
                    <!-- Occupation Tab -->
                    <div class="tab-pane fade" id="occupation" role="tabpanel">
                        <h3>Occupation Series Analysis (Top 20)</h3>
                        <div id="occupationTable"></div>
                    </div>
                    
                    <!-- Timeline Tab -->
                    <div class="tab-pane fade" id="timeline" role="tabpanel">
                        <h3>Executive Order Question Usage by Job Opening Date</h3>
                        <p>Weekly and monthly percentages of jobs posted with the EO question</p>
                        <div id="timelineTable"></div>
                    </div>
                    
                    <!-- Jobs Tab -->
                    <div class="tab-pane fade" id="jobs" role="tabpanel">
                        <h3>All Job Postings with Executive Order Question</h3>
                        <p>Use the search boxes under each column header to filter</p>
                        <table id="jobsTable" class="table table-striped" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Position Title</th>
                                    <th>Occupation</th>
                                    <th>Agency</th>
                                    <th>Location</th>
                                    <th>Grade</th>
                                    <th>Service</th>
                                    <th>Open</th>
                                    <th>Close</th>
                                    <th>USAJobs</th>
                                    <th>Questions</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <script>
        // Load data from JSON files
        async function loadData() {
            try {
                const response = await fetch('analysis_data.json');
                const data = await response.json();
                
                // Populate overview
                document.getElementById('totalScraped').textContent = data.overview.total_scraped.toLocaleString();
                document.getElementById('totalWithEO').textContent = data.overview.total_with_eo.toLocaleString();
                document.getElementById('percentageWithEO').textContent = data.overview.percentage_with_eo + '%';
                document.getElementById('dataCoverage').textContent = data.overview.data_coverage;
                
                // Create simple tables for analyses
                createSimpleTable('serviceTable', data.service_analysis);
                createSimpleTable('gradeTable', data.grade_analysis);
                createSimpleTable('locationTable', data.location_analysis);
                createSimpleTable('agencyTable', data.agency_analysis);
                createSimpleTable('occupationTable', data.occupation_analysis);
                
                // Create timeline heatmap
                createTimelineTable('timelineTable', data.timeline_analysis);
                
                // Initialize DataTable for jobs
                initJobsTable(data.job_postings);
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }
        
        function createSimpleTable(elementId, data) {
            const container = document.getElementById(elementId);
            const table = document.createElement('table');
            table.className = 'table table-hover';
            
            // Find max percentage for scaling
            let maxPercent = 0;
            data.forEach(row => {
                Object.entries(row).forEach(([key, value]) => {
                    if (key.includes('%')) {
                        const percent = parseFloat(value);
                        if (percent > maxPercent) maxPercent = percent;
                    }
                });
            });
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            Object.keys(data[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            data.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(row).forEach((value, index) => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    // Color code percentage columns
                    if (Object.keys(row)[index].includes('%')) {
                        const percent = parseFloat(value);
                        // Scale to max percent in this table
                        const intensity = maxPercent > 0 ? percent / maxPercent : 0;
                        td.style.backgroundColor = `rgba(13, 110, 253, ${intensity})`;
                        td.style.color = intensity > 0.5 ? 'white' : 'black';
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            container.appendChild(table);
        }
        
        function createTimelineTable(elementId, data) {
            const container = document.getElementById(elementId);
            const table = document.createElement('table');
            table.className = 'table table-bordered heatmap-table';
            
            // Find max percentage for scaling
            let maxPercent = 0;
            data.forEach(row => {
                ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Month %'].forEach(key => {
                    if (row[key] !== null && row[key] !== undefined) {
                        const percent = parseFloat(row[key]);
                        if (percent > maxPercent) maxPercent = percent;
                    }
                });
            });
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            ['Month', 'Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Month %', 'Total Jobs', 'With EO'].forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            data.forEach(row => {
                const tr = document.createElement('tr');
                Object.entries(row).forEach(([key, value]) => {
                    const td = document.createElement('td');
                    if (key.includes('Week') || key === 'Month %') {
                        if (value !== null) {
                            td.textContent = value + '%';
                            const percent = parseFloat(value);
                            // Scale to max percent in this table
                            const intensity = maxPercent > 0 ? percent / maxPercent : 0;
                            td.style.backgroundColor = `rgba(13, 110, 253, ${intensity})`;
                            td.style.color = intensity > 0.5 ? 'white' : 'black';
                        } else {
                            td.textContent = '—';
                            td.style.backgroundColor = '#f0f0f0';
                        }
                    } else {
                        td.textContent = value;
                    }
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            
            container.appendChild(table);
        }
        
        function initJobsTable(data) {
            const table = $('#jobsTable').DataTable({
                data: data,
                columns: [
                    { data: 'position_title' },
                    { data: 'occupation' },
                    { data: 'agency' },
                    { data: 'location' },
                    { data: 'grade' },
                    { data: 'service' },
                    { data: 'open_date' },
                    { data: 'close_date' },
                    { 
                        data: 'usajobs_link',
                        render: function(data, type, row) {
                            if (data) {
                                return '<a href="https://www.usajobs.gov/job/' + data + '" target="_blank">View Job</a>';
                            }
                            return '';
                        }
                    },
                    { 
                        data: 'questionnaire_link',
                        render: function(data, type, row) {
                            if (data) {
                                return '<a href="' + data + '" target="_blank">View Questions</a>';
                            }
                            return '';
                        }
                    }
                ],
                pageLength: 50,
                lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
                scrollX: true,
                searching: true,  // Keep global search
                dom: 'lfrtip'    // Standard layout with search box
            });
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>